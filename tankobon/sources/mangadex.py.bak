# coding: utf8

import re

import MangaDexPy

from .. import core

# mangadex has no website frontend yet, match base url plus manga id
RE_URL = re.compile(r"^https://mangadex\.org/(.*)$")


class Manga(core.Manga):

    domain = "mangadex.org"

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

        manga_id = RE_URL.match(self.meta.url).group(1)

        self._client = MangaDexPy.MangaDex()
        self._manga = self._client.manga_(manga_id)

    def metadata(self):
        info = self._manga.data.attributes

        return core.Metadata(
            url=self.meta.url,
            title=info.title["en"],
            alt_titles=[t for at in info.alt_titles for t in at.values()],
        )
